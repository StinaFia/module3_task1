<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hand Gesture Dodger Game</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
        }
        #game-container {
            position: relative;
            width: 400px;
            height: 500px;
            border: 2px solid black;
            margin: 20px auto;
            background-color: lightgray;
            overflow: hidden;
        }
        #player {
            position: absolute;
            left: 175px;
            bottom: 10px;
            width: 50px;
            height: 50px;
            background-color: red;
        }
        .falling-object {
            position: absolute;
            width: 30px;
            height: 30px;
            background-color: blue;
        }
    </style>
</head>
<body>
    <h1>Hand Gesture Dodger Game</h1>
    <button onclick="init()">Start Game</button>
    <div id="webcam-container"></div>
    <p>Score: <span id="score">0</span></p>
    <div id="game-container">
        <div id="player"></div>
    </div>
    
    <script>
        const URL = "https://teachablemachine.withgoogle.com/models/r60MHrX38/";
        let model, webcam, playerX = 175, score = 0;
        let gameInterval, objectInterval;
        const gameContainer = document.getElementById("game-container");
        const player = document.getElementById("player");
        const scoreDisplay = document.getElementById("score");

        async function init() {
            const modelURL = URL + "model.json";
            const metadataURL = URL + "metadata.json";
            model = await tmImage.load(modelURL, metadataURL);
            
            webcam = new tmImage.Webcam(200, 200, true); 
            await webcam.setup();
            await webcam.play();
            document.getElementById("webcam-container").appendChild(webcam.canvas);

            score = 0;
            scoreDisplay.innerText = score;
            gameInterval = setInterval(updateGame, 50);
            objectInterval = setInterval(createFallingObject, 1000);

            requestAnimationFrame(loop);
        }

        async function loop() {
            webcam.update();
            await predict();
            requestAnimationFrame(loop);
        }

        async function predict() {
            const prediction = await model.predict(webcam.canvas);

            if (prediction[0].probability > 0.9) {
                playerX = Math.max(playerX - 10, 0);
            } else if (prediction[1].probability > 0.9) {
                playerX = Math.min(playerX + 10, 350);
            }

            player.style.left = playerX + "px";
        }

        function createFallingObject() {
            const obj = document.createElement("div");
            obj.classList.add("falling-object");
            obj.style.left = Math.random() * 370 + "px"; // Random x position
            obj.style.top = "0px";
            gameContainer.appendChild(obj);
        }

        function updateGame() {
            score++;
            scoreDisplay.innerText = score;

            const objects = document.getElementsByClassName("falling-object");
            for (let obj of objects) {
                let newY = parseInt(obj.style.top) + 5;
                obj.style.top = newY + "px";

                if (newY > 470) {
                    obj.remove();
                }

                if (checkCollision(obj, player)) {
                    endGame();
                }
            }
        }

        function checkCollision(obj, player) {
            let objRect = obj.getBoundingClientRect();
            let playerRect = player.getBoundingClientRect();

            return !(
                objRect.bottom < playerRect.top ||
                objRect.top > playerRect.bottom ||
                objRect.right < playerRect.left ||
                objRect.left > playerRect.right
            );
        }

        function endGame() {
            clearInterval(gameInterval);
            clearInterval(objectInterval);
            alert("Game Over! Your Score: " + score);
            location.reload(); // Restart game
        }
    </script>
</body>
</html>
